<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stack Smash Pro - @Catechlk</title>
    <style>
        body { margin: 0; overflow: hidden; background: #f0f0f0; font-family: 'Segoe UI', sans-serif; }
        #ui-container { position: absolute; top: 30px; width: 100%; text-align: center; pointer-events: none; }
        #score { font-size: 60px; font-weight: 900; color: #444; opacity: 0.5; }
        
        /* Game Over Overlay */
        #game-over {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.9); display: none;
            flex-direction: column; align-items: center; justify-content: center; z-index: 100;
        }
        #game-over h1 { font-size: 50px; color: #e63946; margin: 0; }
        button { 
            padding: 15px 40px; font-size: 20px; background: #444; color: white; 
            border: none; border-radius: 30px; cursor: pointer; margin-top: 20px;
        }
    </style>
</head>
<body>
    <div id="ui-container"><div id="score">0</div></div>
    
    <div id="game-over">
        <h1>GAME OVER</h1>
        <p id="final-score">Score: 0</p>
        <button onclick="location.reload()">TRY AGAIN</button>
    </div>

    <script type="module">
        import * as THREE from 'https://unpkg.com/three@0.158.0/build/three.module.js';

        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xe0e0e0);
        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 8, 15);
        camera.lookAt(0, 0, 0);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        scene.add(new THREE.AmbientLight(0xffffff, 0.8));
        const dirLight = new THREE.DirectionalLight(0xffffff, 0.5);
        dirLight.position.set(5, 10, 5);
        scene.add(dirLight);

        const towerGroup = new THREE.Group();
        scene.add(towerGroup);
        const slices = [];
        let gameActive = true;

        // Create Tower
        for (let i = 0; i < 60; i++) {
            const group = new THREE.Group();
            const geo = new THREE.CylinderGeometry(3, 3, 0.4, 32);
            const mat = new THREE.MeshStandardMaterial({ color: i % 2 === 0 ? "#a8dadc" : "#f1faee" });
            const slice = new THREE.Mesh(geo, mat);
            group.add(slice);
            group.position.y = -i * 0.6;
            group.rotation.y = i * 0.4;
            towerGroup.add(group);
            slices.push(group);
        }

        const ball = new THREE.Mesh(new THREE.SphereGeometry(0.4, 32, 32), new THREE.MeshStandardMaterial({ color: "#e63946" }));
        ball.position.set(0, 1, 3);
        scene.add(ball);

        let score = 0, dy = 0, isSmashing = false, rotationSpeed = 0.015;

        window.onmousedown = () => { if(gameActive) isSmashing = true; }
        window.onmouseup = () => isSmashing = false;

        function animate() {
            if(!gameActive) return;
            requestAnimationFrame(animate);

            if (!isSmashing) {
                dy -= 0.01;
                ball.position.y += dy;
                if (ball.position.y < 0.5) dy = 0.15;
                towerGroup.rotation.y += rotationSpeed;
            } else {
                ball.position.y -= 0.25;
                towerGroup.position.y += 0.25;
                
                slices.forEach(s => {
                    if (s.visible && Math.abs(ball.position.y - s.position.y - towerGroup.position.y) < 0.4) {
                        s.visible = false;
                        score++;
                        document.getElementById('score').innerText = score;
                        // Increase difficulty
                        rotationSpeed += 0.0001;
                    }
                });
            }

            // Game Over Condition (If ball falls too far without hitting slices - optional logic)
            if(ball.position.y < -30) gameOver();

            renderer.render(scene, camera);
        }

        function gameOver() {
            gameActive = false;
            document.getElementById('game-over').style.display = 'flex';
            document.getElementById('final-score').innerText = "Final Score: " + score;
        }

        animate();
    </script>
</body>
</html>
